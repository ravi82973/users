<!-- <ngx-spinner bdColor="rgba(51, 51, 51, 0.8)" size="medium" type="ball-spin-clockwise"></ngx-spinner> -->
<!-- size="medium" type="ball-fussion" -->
<!-- <ngx-spinner bdColor="rgba(51,51,51,0.8)" size="large" color="#fff" type="ball-circus" [fullScreen] = "true"></ngx-spinner> -->
<ngx-spinner bdColor="rgba(51,51,51,0.8)" size="medium" color="white" type="ball-clip-rotate-multiple">
    <p style="font-size: 16px; color: white">Loading...</p>
</ngx-spinner>
<app-header (isFilter)="filterToggle($event)"></app-header>



<div class="container-fluid">
    <div class="row">
        <nav id="sidebar" class="col-lg-2 px-0 d-block sidebar collapse"  *ngIf="clicked"  >
            <div class="position-sticky">
                <ul class="list-unstyled components">
                    <li><a style="cursor: pointer;"  data-toggle="collapse"><img src="assets/images/filter.png" alt="filter"> Filter <i
                                class="fa fa-long-arrow-left float-end" aria-hidden="true" (click)="closeFilter()"></i></a></li>
                    <li><a href="#Submenu" data-toggle="collapse" aria-expanded="false">Dealership</a>
                        <ul class="collapse list-unstyled" id="Submenu">
                            <li>
                                <div class="col-12" *ngFor="let str of storesList">
                                  
                                    <label class="round">{{str.DealerShipName}}
                                        <input type="checkbox" (change)="dealerlist($event,str)" [checked]="str.Status=='true'">
                                        <span class="checkmark"></span>
                                    </label>
                                </div>
                                <div class="pt-3 text-end high_clr" style="cursor: pointer;" ><span (click)="clear('D',container)"> clear filter </span></div>

                            </li>
                        </ul>
                    </li>
                    <li><a href="#homeSubmenu" data-toggle="collapse" aria-expanded="false">Score </a>
                        <ul class="collapse list-unstyled" id="homeSubmenu">
                            <li>

                                <div class="d-flex text-center align-items-center col-12">
                                    <div class="col-lg-5"><input type="text" class="w-100" [(ngModel)]="scoreFrom"
                                            (focusout)="scoresalesservice($event,'F','score')" maxlength="2"
                                            (keypress)="keyPressNumbers($event)"></div>
                                    <div class="col-lg-2">to</div>
                                    <div class="col-lg-5"><input type="text" class="w-100" [(ngModel)]="scoreTo"
                                            (focusout)="scoresalesservice($event,'T','score')" maxlength="2"
                                            (keypress)="keyPressNumbers($event)"> </div>
                                </div>
                                <div class="pt-3 text-end high_clr" style="cursor: pointer;" > <span (click)="clear('SC',container)">clear filter </span></div>

                            </li>
                        </ul>
                    </li>
                    <li><a href="#homeSubmenu1" data-toggle="collapse" aria-expanded="false">Sales Value</a>
                        <ul class="collapse list-unstyled" id="homeSubmenu1">
                            <li>

                                <div class="d-flex text-center align-items-center col-12">
                                    <div class="col-lg-5"><input type="number" class="w-100" [(ngModel)]="salesFrom"
                                            (focusout)="scoresalesservice($event,'F','sales')"
                                            (keypress)="keyPressNumbers($event)"></div>
                                    <div class="col-lg-2">to</div>
                                    <div class="col-lg-5"><input type="number" class="w-100" [(ngModel)]="salesTo"
                                            (focusout)="scoresalesservice($event,'T','sales')"
                                            (keypress)="keyPressNumbers($event)"></div>
                                </div>
                                <div class="pt-3 text-end high_clr" style="cursor: pointer;" > <span (click)="clear('SL',container)">clear filter </span></div>

                            </li>
                        </ul>
                    </li>
                    <li><a href="#homeSubmenu2" data-toggle="collapse" aria-expanded="false">Service Value</a>
                        <ul class="collapse list-unstyled" id="homeSubmenu2">
                            <li>

                                <div class="d-flex text-center align-items-center col-12">
                                    <div class="col-lg-5"><input type="number" class="w-100" [(ngModel)]="servicesFrom"
                                            (focusout)="scoresalesservice($event,'F','service')"
                                            (keypress)="keyPressNumbers($event)"></div>
                                    <div class="col-lg-2">to</div>
                                    <div class="col-lg-5"><input type="number" class="w-100" [(ngModel)]="servicesTo"
                                            (focusout)="scoresalesservice($event,'T','service')"
                                            (keypress)="keyPressNumbers($event)"></div>
                                </div>
                                <div class="pt-3 text-end high_clr" style="cursor: pointer;"> <span (click)="clear('SR',container)">clear filter </span></div>

                            </li>
                        </ul>
                    </li>
                    <li><a href="#homeSubmenu3" data-toggle="collapse" aria-expanded="false">Brand</a>
                        <ul class="collapse list-unstyled" id="homeSubmenu3">
                            <li>
                                <div class="col-12">
                                    <select class="_dropdwn" [(ngModel)]="brandValue" >
                                        <option value='0'>Select</option>
                                        <option *ngFor="let bd of brandsList" [value]="bd.brand_chrome_id">{{bd.brand_name}}</option>
                                    </select>
                                </div>
                                <div class="pt-3 text-end high_clr" style="cursor: pointer;" ><span (click)="clear('BD',container)">clear filter </span></div>

                            </li>
                        </ul>
                    </li>
                    <li><a href="#homeSubmenu4" data-toggle="collapse" aria-expanded="false">Proximity</a>
                        <ul class="collapse list-unstyled" id="homeSubmenu4">
                            <li>
                                <div class="col-12">
                                    <select class="_dropdwn" [(ngModel)]="proximityValue" >
                                        <option value='0'>Select</option>
                                        <option value='50'>&#60;50 miles</option>
                                        <option value='30'>&#60;30 miles</option>
                                        <option value='20'>&#60;20 miles</option>
                                        <option value='10'>&#60;10 miles</option>
                                        <option value='5'>&#60;5 miles</option>
                                        <option value='2'>&#60;2 miles</option>
                                        <option value='1'>&#60;1 mile</option>

                                        <!-- <option *ngFor="let bd of brandsList" [value]="bd.brand_chrome_id">{{bd.brand_name}}</option> -->
                                    </select>
                                </div>
                                <div class="pt-3 text-end high_clr" style="cursor: pointer;" ><span (click)="clear('P',container)">clear filter </span></div>

                            </li>
                        </ul>
                    </li>
                    <li><a href="#homeSubmenu5" data-toggle="collapse" aria-expanded="false">Vehicle Equity($)</a>
                        <ul class="collapse list-unstyled" id="homeSubmenu5">
                            <li>
                                <div class="col-12">
                                <select class="_dropdwn" [(ngModel)]="VehicleEquityValue" >
                                    <option value='0'>Select</option>
                                    <option value='$65,000'>&#62;$65,000</option>
                                    <option value='$50,000'>&#62;$50,000</option>
                                    <option value='$30,000'>&#62;$30,000</option>
                                    <option value='$10,000'>&#62;$10,000</option>
                                </select>
                            </div>

                                <div class="pt-3 text-end high_clr" style="cursor: pointer;" ><span (click)="clear('VE',container)">clear filter </span></div>

                            </li>
                        </ul></li>
                    <li><a href="#homeSubmenu6" data-toggle="collapse" aria-expanded="false">Interaction Frequency</a>
                        <ul class="collapse list-unstyled" id="homeSubmenu6">
                            <li>
                                <div class="col-5">
                                    <select class="_dropdwn" [(ngModel)]="interactionFreqvalue" >
                                        <option value='0'>Select</option>
                                        <option value='70%'>&#62;70%</option>
                                        <option value='50%'>&#62;50%</option>
                                        <option value='30%'>&#62;30%</option>
                                        <option value='20%'>&#62;20%</option>
                                        <option value='10%'>&#62;10%</option>

                                    </select>
                                </div>
    
                                <div class="pt-4 text-end high_clr" style="cursor: pointer;" ><span (click)="clear('IF',container)" class="mb-2">clear filter </span></div>

                            </li>
                        </ul></li>
                    <br><br>
                    <li>
                        <div class="d-flex align-items-center justify-content-center px-3">
                            <div class="col-lg-6 col-12">
                                <button class="submit" (click)="apply(container)" (click)="container.scrollTop = 0">Apply</button>&nbsp;
                            </div>
                            <div class="col-lg-6 col-12">
                                <button class="clear" (click)="clear('All',container)">Clear</button>
                            </div>

                        <!-- <button class="submit" (click)="apply(container)" (click)="container.scrollTop = 0">Apply</button>&nbsp;
                        <button class="clear" (click)="clear('All',container)">Clear</button> -->
                    </div>

                    </li>


                </ul>

            </div>
        </nav>
        <main class="col-lg-10 ms-auto">
            <div class="auto_w">
                <div class="row mt-4">
                    <div class="col-lg-6 col-7">
                        <form class="navbar-form" role="search">
                            <div class="input-group search">
                                <div class="input-group-btn">
                                    <button class="btn btn_search" type="submit"></button>
                                </div>
                                <input class="form-control" placeholder="Search" type="text" [(ngModel)]="searchText"
                                    [ngModelOptions]="{standalone: true}">

                            </div>
                        </form>
                    </div>
                    <div class="col-lg-3 col-3 ms-auto">
                        <div class="d-flex justify-content-end">
                            <button class="btn bar"><i class="fa fa-bars" aria-hidden="true"></i></button>
                            <button class="btn dots"><i class="fa fa-th-large" aria-hidden="true"></i></button>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-12 count"><span>{{(customersList | filter:searchText).length}}</span> Results
                    </div>
                </div>
                <div class="row scroll_grid" style="font-size: medium;margin: 1rem 26rem;align-items: flex-start;" *ngIf="isNoRec && (customersList | filter:searchText).length == '0'">
                    No Records Found!!
                </div>
                <div class="row scroll_grid" #container >
                    <div class="col-lg-3 col-6" *ngFor="let cd of customersList | filter:searchText">
                        <div class="customer-card">
                            <div class="d-flex justify-content-around"
                                [ngClass]="{ head_blk : cd.SalesScore[0] > '80', head_ylw: cd.SalesScore[0] >= '71' && cd.SalesScore[0] <= '80', head_grn: cd.SalesScore[0] >= '60' && cd.SalesScore[0] <= '70', head_gry:cd.SalesScore[0] < '60'  }">
                                <div class="d-flex flex-column justify-content-center align-items-center">
                                    <h3 class="mt-0 mb-0">{{cd.SalesScore[0]}}</h3>
                                    <span class="mt-0 mb-0">Sales</span>
                                </div>
                                <div class="d-flex flex-column justify-content-center align-items-center">
                                    <h3 class="mt-0 mb-0">{{cd.ServiceScore}}</h3>
                                    <span class="mt-0 mb-0">Service</span>
                                </div>
                                <div class="d-flex flex-column justify-content-center align-items-center">
                                    <h3 class="mt-0 mb-0">{{cd.LTVScore}}</h3>
                                    <span class="mt-0 mb-0">LTV</span>
                                </div>
                            </div>

                            <div class="p-lg-2 p-2">
                                <div class="customer-details d-flex align-items-start">
                                    <img class="img-fluid flex-shrink-0 rounded-circle"
                                        src="https://www.gravatar.com/avatar/00000000000000000000000000000000?d=mp&f=y">
                                    <div class="d-flex flex-column align-items-start ps-lg-3 ps-2 my-auto">
                                        <h6 class="mt-0 mb-0">{{cd.DataSince[0]}}</h6>
                                        <h4 class="mt-0 mb-1" title="{{cd.UserName[0]}}">   {{(cd.UserName == undefined ? '--' : ( (cd.UserName[0].toString() | slice:0:15) +
                                            (cd.UserName[0].toString().length > 15 ? '...' : '') ))}}</h4>
                                        <h5 class="mt-0 mb-0">{{cd.Mobile[0]}}</h5>
                                        <span style="cursor: pointer;color: #00a1ff; text-transform: lowercase !important;" class="mt-0 mb-0 " title="{{cd.Email[0]}}">
                                            {{(cd.Email == undefined ? '--' : ( (cd.Email[0].toString() | slice:0:20) +
                                            (cd.Email[0].toString().length > 20 ? '...' : '') ))}}
                                            <!-- {{cd.Email[0]}} -->
                                        </span>
                                    </div>
                                </div>

                                <div class="sales-details mt-3">
                                    <h2 class="title mt-0 mb-0"><span>SALES</span>
                                        <hr />
                                    </h2>
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h6 class="mt-0 mb-0">Vehicles ({{cd.CurrentTotalVehicles}})</h6>
                                            <h6 class="mt-0 mb-0">Lifetime</h6>
                                        </div>
                                        <div>
                                            <h6 class="mt-0 mb-0">${{cd.CurrentVehiclesPrice*1 | number}}</h6>
                                            <h6 class="mt-0 mb-0">${{cd.LifetimeTotalPrice*1 | number }}</h6>
                                        </div>
                                        <div>
                                            <div class="gross d-flex justify-content-between align-items-center">
                                                <span class="me-1">GROSS</span>
                                                <h6 class="float-end mt-0 mb-0">${{cd.CurrentVehiclesGross*1 | number}}
                                                </h6>
                                            </div>
                                            <div class="gross d-flex justify-content-between align-items-center">
                                                <span class="me-1">GROSS</span>
                                                <h6 class="float-end mt-0 mb-0">${{cd.LifetimeGross*1 | number}}</h6>
                                            </div>
                                        </div>

                                    </div>
                                </div>

                                <div class="sales-details mt-3">
                                    <h2 class="title  mt-0 mb-0"><span>SERVICE</span>
                                        <hr />
                                    </h2>
                                    <div class="d-flex justify-content-between text-center">
                                        <div>
                                            <h6 class="mt-0 mb-0">YTD</h6>
                                            <h6 class="mt-0 mb-0">${{cd.YTDServiceAmount[0]}}</h6>
                                        </div>
                                        <div>
                                            <h6 class="mt-0 mb-0">3 Years</h6>
                                            <h6 class="mt-0 mb-0">{{cd.CurrentServiceAmount[0] | currency : 'USD' :
                                                'symbol' : '1.0-0' }}</h6>
                                        </div>
                                        <div>
                                            <h6 class="mt-0 mb-0">Lifetime</h6>
                                            <h6 class="mt-0 mb-0">{{cd.ServiceLifetime[0] | currency : 'USD' : 'symbol'
                                                : '1.0-0' }}</h6>
                                        </div>
 
                                    </div>
                                </div>

                                <div class="view text-center mt-4">
                                    <div class="mt-0 mb-0" style="cursor: pointer;color: #00a1ff;" (click)="fullHistory(cd)">View full
                                        history</div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

              
                <div>

                </div>
                <div>

                </div>
            </div>
        </main>
    </div>
</div>

<div class="modal fade bd-example-modal-sm" id="validations" tabindex="-1" aria-labelledby="contModalLabel"
    aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content modal-sm">
            <div class="modal-header">

                <span class="warn_head">Alerts</span>

                <span data-bs-dismiss="modal" aria-label="Close" style="cursor: pointer;" class="cancel_head">X
                </span>

            </div>
            <div class="modal-body">
                <div *ngIf="scoreTo!='' && scoreFrom=='' " class="mb-2">
                    <span class="validMsg"> Please enter scores</span>
                </div>
                <div *ngIf="scoreTo=='' && scoreFrom!='' " class="mb-2">
                    <span class="validMsg"> Please enter scores</span>
                </div>
                <div *ngIf="salesTo!='' && salesFrom==''" class="mb-2">
                    <span class="validMsg">Please enter slaes values</span>
                </div>
                <div *ngIf="salesTo=='' && salesFrom!=''" class="mb-2">
                    <span class="validMsg">Please enter sales values</span>
                </div>
                <div *ngIf="servicesTo!='' && servicesFrom==''" class="mb-2">
                    <span class="validMsg"> Please enter service values </span>
                </div>
                <div *ngIf="servicesTo=='' && servicesFrom!=''" class="mb-2">
                    <span class="validMsg"> Please enter service values </span>
                </div>
                <div *ngIf="scoreTo!='' && scoreFrom!='' " class="mb-2">
                    <span *ngIf="scoreTo*1 < scoreFrom*1 " class="validMsg">Score to value should be more than from value</span>
                </div>
                <div *ngIf="salesTo!='' && salesFrom!=''" class="mb-2">
                    <span *ngIf="salesTo*1 < salesFrom*1" class="validMsg">Sales to value should be more than from value</span>
                </div>
                <div *ngIf="servicesTo!='' && servicesFrom!=''" class="mb-2">
                    <span *ngIf="servicesTo*1 < servicesFrom*1" class="validMsg">Service to value should be more than from value</span>
                </div>
                <div *ngIf="scoreTo!='' && scoreFrom!='' " class="mb-2">
                    <span *ngIf="scoreTo*1 === scoreFrom*1 " class="validMsg"> Score to value should be more than from value </span>
                </div>
                <div *ngIf="salesTo!='' && salesFrom!=''" class="mb-2">
                    <span *ngIf="salesTo*1 === salesFrom*1" class="validMsg">Sales to value should be more than from value </span>
                </div>
                <div *ngIf="servicesTo!='' && servicesFrom!=''" class="mb-2">
                    <span *ngIf="servicesTo*1 === servicesFrom*1" class="validMsg"> Service to value should be more than from value </span>
                </div>
             <div>
                 <button class="clear_body" data-bs-dismiss="modal" aria-label="Close">ok</button>               
             </div>
            </div>

        </div>
    </div>
</div>


<button id="validation" [hidden]='true' data-bs-toggle="modal" data-bs-target="#validations"> </button>
<!--  -->